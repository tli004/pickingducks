this.JS=this.JS||{},JS.extend=function(_,e){e=e||{};for(var n in e)_[n]!==e[n]&&(_[n]=e[n]);return _},JS.extend(JS,{makeFunction:function(){return function(){return this.initialize?this.initialize.apply(this,arguments)||this:this}},makeBridge:function(_){var e=function(){};return e.prototype=_.prototype,new e},bind:function(){var _=JS.array(arguments),e=_.shift(),n=_.shift()||null;return function(){return e.apply(n,_.concat(JS.array(arguments)))}},callsSuper:function(_){return void 0===_.SUPER?_.SUPER=/\bcallSuper\b/.test(_.toString()):_.SUPER},mask:function(_){var e=_.toString().replace(/callSuper/g,"super");return _.toString=function(){return e},_},array:function(_){if(!_)return[];if(_.toArray)return _.toArray();for(var e=_.length,n=[];e--;)n[e]=_[e];return n},indexOf:function(_,e){for(var n=0,t=_.length;t>n;n++)if(_[n]===e)return n;return-1},isFn:function(_){return _ instanceof Function},isType:function(_,e){return _&&e?e instanceof Function&&_ instanceof e||"string"==typeof e&&typeof _===e||_.isA&&_.isA(e):!1},ignore:function(_,e){return/^(include|extend)$/.test(_)&&"object"==typeof e}}),JS.Module=JS.makeFunction(),JS.extend(JS.Module.prototype,{END_WITHOUT_DOT:/([^\.])$/,initialize:function(_,e,n){this.__mod__=this,this.__inc__=[],this.__fns__={},this.__dep__=[],this.__mct__={},"string"==typeof _?this.__nom__=this.displayName=_:(this.__nom__=this.displayName="",n=e,e=_),n=n||{},this.__res__=n._1||null,e&&this.include(e,!1),JS.Module.__chainq__&&JS.Module.__chainq__.push(this)},setName:function(_){this.__nom__=this.displayName=_||"";for(var e in this.__mod__.__fns__)this.__name__(e);_&&this.__meta__&&this.__meta__.setName(_+".")},__name__:function(_){if(this.__nom__){var e=this.__mod__.__fns__[_]||{};return _=this.__nom__.replace(this.END_WITHOUT_DOT,"$1#")+_,JS.isFn(e.setName)?e.setName(_):(JS.isFn(e)&&(e.displayName=_),void 0)}},define:function(_,e,n,t){var i=(t||{})._0||this;this.__fns__[_]=e,this.__name__(_),JS.Module._0&&i&&JS.isFn(e)&&JS.Module._0(_,i),n!==!1&&this.resolve()},instanceMethod:function(_){var e=this.lookup(_).pop();return JS.isFn(e)?e:null},instanceMethods:function(_,e){var n,t=this.__mod__,e=e||[],i=t.ancestors(),s=i.length;for(n in t.__fns__)t.__fns__.hasOwnProperty(n)&&JS.isFn(t.__fns__[n])&&-1===JS.indexOf(e,n)&&e.push(n);if(_===!1)return e;for(;s--;)i[s].instanceMethods(!1,e);return e},include:function(_,e,n){if(e=e!==!1,!_)return e?this.resolve():this.uncache();n=n||{},_.__mod__&&(_=_.__mod__);var t,i,s,r,o=_.include,u=_.extend,a=n._4||this;if(_.__inc__&&_.__fns__)this.__inc__.push(_),_.__dep__.push(this),n._2?_.extended&&_.extended(n._2):_.included&&_.included(a);else{if(!n._5){if("object"==typeof o||JS.isType(o,JS.Module))for(t=[].concat(o),s=0,r=t.length;r>s;s++)a.include(t[s],e,n);if("object"==typeof u||JS.isType(u,JS.Module)){for(t=[].concat(u),s=0,r=t.length;r>s;s++)a.extend(t[s],!1);a.extend()}return n._5=!0,a.include(_,e,n)}for(i in _)JS.ignore(i,_[i])||this.define(i,_[i],!1,{_0:a||n._2||this})}e?this.resolve():this.uncache()},includes:function(_){var e=this.__mod__,n=e.__inc__.length;if(Object===_||e===_||e.__res__===_.prototype)return!0;for(;n--;)if(e.__inc__[n].includes(_))return!0;return!1},match:function(_){return _.isA&&_.isA(this)},ancestors:function(_){var e,n,t=this.__mod__,i=void 0===_,s=(t.__res__||{}).klass,r=s&&t.__res__===s.prototype?s:t;if(i&&t.__anc__)return t.__anc__.slice();for(_=_||[],e=0,n=t.__inc__.length;n>e;e++)t.__inc__[e].ancestors(_);return-1===JS.indexOf(_,r)&&_.push(r),i&&(t.__anc__=_.slice()),_},lookup:function(_){var e=this.__mod__,n=e.__mct__;if(n[_])return n[_].slice();var t,i,s,r=e.ancestors(),o=[];for(t=0,i=r.length;i>t;t++)s=r[t].__mod__.__fns__[_],s&&o.push(s);return n[_]=o.slice(),o},make:function(_,e){if(!JS.isFn(e)||!JS.callsSuper(e))return e;var n=this;return function(){return n.chain(this,_,arguments)}},chain:JS.mask(function(_,e,n){var t,i=this.lookup(e),s=i.length-1,r=_.callSuper,o=JS.array(n);return _.callSuper=function(){for(var e=arguments.length;e--;)o[e]=arguments[e];s-=1;var n=i[s].apply(_,o);return s+=1,n},t=i.pop().apply(_,o),r?_.callSuper=r:delete _.callSuper,t}),resolve:function(_){var e,n,t,i,s=this.__mod__,_=_||s,r=_.__res__;if(_===s)for(s.uncache(!1),e=s.__dep__.length;e--;)s.__dep__[e].resolve();if(r){for(e=0,n=s.__inc__.length;n>e;e++)s.__inc__[e].resolve(_);for(t in s.__fns__)i=_.make(t,s.__fns__[t]),r[t]!==i&&(r[t]=i)}},uncache:function(_){var e=this.__mod__,n=e.__dep__.length;if(e.__anc__=null,e.__mct__={},_!==!1)for(;n--;)e.__dep__[n].uncache()}}),JS.Class=JS.makeFunction(),JS.extend(JS.Class.prototype=JS.makeBridge(JS.Module),{initialize:function(_,e,n){"string"==typeof _?this.__nom__=this.displayName=_:(this.__nom__=this.displayName="",n=e,e=_);var t=JS.extend(JS.makeFunction(),this);t.klass=t.constructor=this.klass,JS.isFn(e)||(n=e,e=Object),t.inherit(e),t.include(n,!1),t.resolve();do e.inherited&&e.inherited(t);while(e=e.superclass);return t},inherit:function(_){this.superclass=_,this.__eigen__&&_.__eigen__&&this.extend(_.__eigen__(),!0),this.subclasses=[],(_.subclasses||[]).push(this);var e=this.prototype=JS.makeBridge(_);e.klass=e.constructor=this,this.__mod__=new JS.Module(this.__nom__,{},{_1:this.prototype}),this.include(JS.Kernel,!1),_!==Object&&this.include(_.__mod__||new JS.Module(_.prototype,{_1:_.prototype}),!1)},include:function(_,e,n){if(_){var t=this.__mod__,n=n||{};return n._4=this,t.include(_,e,n)}},define:function(_,e,n,t){var i=this.__mod__;t=t||{},t._0=this,i.define(_,e,n,t)}}),JS.Module=new JS.Class("Module",JS.Module.prototype),JS.Class=new JS.Class("Class",JS.Module,JS.Class.prototype),JS.Module.klass=JS.Module.constructor=JS.Class.klass=JS.Class.constructor=JS.Class,JS.extend(JS.Module,{_3:[],__chainq__:[],methodAdded:function(_,e){this._3.push([_,e])},_0:function(_,e){for(var n=this._3,t=n.length;t--;)n[t][0].call(n[t][1]||null,_,e)}}),JS.Kernel=JS.extend(new JS.Module("Kernel",{__eigen__:function(){if(this.__meta__)return this.__meta__;var _=this.__nom__,e=this.klass.__nom__,n=_||(e?"#<"+e+">":""),t=this.__meta__=new JS.Module(n?n+".":"",{},{_1:this});return t.include(this.klass.__mod__,!1),t},equals:function(_){return this===_},extend:function(_,e){return this.__eigen__().include(_,e,{_2:this})},hash:function(){return this.__hashcode__=this.__hashcode__||JS.Kernel.getHashCode()},isA:function(_){return this.__eigen__().includes(_)},method:function(_){var e=this,n=e.__mcache__=e.__mcache__||{};return(n[_]||{}).fn===e[_]?n[_].bd:(n[_]={fn:e[_],bd:JS.bind(e[_],e)}).bd},methods:function(){return this.__eigen__().instanceMethods(!0)},tap:function(_,e){return _.call(e||null,this),this}}),{__hashIndex__:0,getHashCode:function(){return this.__hashIndex__+=1,(Math.floor((new Date).getTime()/1e3)+this.__hashIndex__).toString(16)}}),JS.Module.include(JS.Kernel),JS.extend(JS.Module,JS.Kernel.__fns__),JS.Class.include(JS.Kernel),JS.extend(JS.Class,JS.Kernel.__fns__),JS.Interface=new JS.Class({initialize:function(_){this.test=function(e,n){for(var t=_.length;t--;)if(!JS.isFn(e[_[t]]))return n?_[t]:!1;return!0}},extend:{ensure:function(){for(var _,e,n=JS.array(arguments),t=n.shift();_=n.shift();)if(e=_.test(t,!0),e!==!0)throw new Error("object does not implement "+e+"()")}}}),JS.Singleton=new JS.Class({initialize:function(_,e,n){return new new JS.Class(_,e,n)}});