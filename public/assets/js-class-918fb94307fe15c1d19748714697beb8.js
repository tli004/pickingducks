this.JS=this.JS||{},JS.extend=function(t,e){e=e||{};for(var i in e)t[i]!==e[i]&&(t[i]=e[i]);return t},JS.extend(JS,{makeFunction:function(){return function(){return this.initialize?this.initialize.apply(this,arguments)||this:this}},makeBridge:function(t){var e=function(){};return e.prototype=t.prototype,new e},bind:function(){var t=JS.array(arguments),e=t.shift(),i=t.shift()||null;return function(){return e.apply(i,t.concat(JS.array(arguments)))}},callsSuper:function(t){return void 0===t.SUPER?t.SUPER=/\bcallSuper\b/.test(t.toString()):t.SUPER},mask:function(t){var e=t.toString().replace(/callSuper/g,"super");return t.toString=function(){return e},t},array:function(t){if(!t)return[];if(t.toArray)return t.toArray();for(var e=t.length,i=[];e--;)i[e]=t[e];return i},indexOf:function(t,e){for(var i=0,n=t.length;n>i;i++)if(t[i]===e)return i;return-1},isFn:function(t){return t instanceof Function},isType:function(t,e){return t&&e?e instanceof Function&&t instanceof e||"string"==typeof e&&typeof t===e||t.isA&&t.isA(e):!1},ignore:function(t,e){return/^(include|extend)$/.test(t)&&"object"==typeof e}}),JS.Module=JS.makeFunction(),JS.extend(JS.Module.prototype,{END_WITHOUT_DOT:/([^\.])$/,initialize:function(t,e,i){this.__mod__=this,this.__inc__=[],this.__fns__={},this.__dep__=[],this.__mct__={},"string"==typeof t?this.__nom__=this.displayName=t:(this.__nom__=this.displayName="",i=e,e=t),i=i||{},this.__res__=i._1||null,e&&this.include(e,!1),JS.Module.__chainq__&&JS.Module.__chainq__.push(this)},setName:function(t){this.__nom__=this.displayName=t||"";for(var e in this.__mod__.__fns__)this.__name__(e);t&&this.__meta__&&this.__meta__.setName(t+".")},__name__:function(t){if(this.__nom__){var e=this.__mod__.__fns__[t]||{};return t=this.__nom__.replace(this.END_WITHOUT_DOT,"$1#")+t,JS.isFn(e.setName)?e.setName(t):(JS.isFn(e)&&(e.displayName=t),void 0)}},define:function(t,e,i,n){var s=(n||{})._0||this;this.__fns__[t]=e,this.__name__(t),JS.Module._0&&s&&JS.isFn(e)&&JS.Module._0(t,s),i!==!1&&this.resolve()},instanceMethod:function(t){var e=this.lookup(t).pop();return JS.isFn(e)?e:null},instanceMethods:function(t,e){var i,n=this.__mod__,e=e||[],s=n.ancestors(),a=s.length;for(i in n.__fns__)n.__fns__.hasOwnProperty(i)&&JS.isFn(n.__fns__[i])&&-1===JS.indexOf(e,i)&&e.push(i);if(t===!1)return e;for(;a--;)s[a].instanceMethods(!1,e);return e},include:function(t,e,i){if(e=e!==!1,!t)return e?this.resolve():this.uncache();i=i||{},t.__mod__&&(t=t.__mod__);var n,s,a,o,r=t.include,l=t.extend,h=i._4||this;if(t.__inc__&&t.__fns__)this.__inc__.push(t),t.__dep__.push(this),i._2?t.extended&&t.extended(i._2):t.included&&t.included(h);else{if(!i._5){if("object"==typeof r||JS.isType(r,JS.Module))for(n=[].concat(r),a=0,o=n.length;o>a;a++)h.include(n[a],e,i);if("object"==typeof l||JS.isType(l,JS.Module)){for(n=[].concat(l),a=0,o=n.length;o>a;a++)h.extend(n[a],!1);h.extend()}return i._5=!0,h.include(t,e,i)}for(s in t)JS.ignore(s,t[s])||this.define(s,t[s],!1,{_0:h||i._2||this})}e?this.resolve():this.uncache()},includes:function(t){var e=this.__mod__,i=e.__inc__.length;if(Object===t||e===t||e.__res__===t.prototype)return!0;for(;i--;)if(e.__inc__[i].includes(t))return!0;return!1},match:function(t){return t.isA&&t.isA(this)},ancestors:function(t){var e,i,n=this.__mod__,s=void 0===t,a=(n.__res__||{}).klass,o=a&&n.__res__===a.prototype?a:n;if(s&&n.__anc__)return n.__anc__.slice();for(t=t||[],e=0,i=n.__inc__.length;i>e;e++)n.__inc__[e].ancestors(t);return-1===JS.indexOf(t,o)&&t.push(o),s&&(n.__anc__=t.slice()),t},lookup:function(t){var e=this.__mod__,i=e.__mct__;if(i[t])return i[t].slice();var n,s,a,o=e.ancestors(),r=[];for(n=0,s=o.length;s>n;n++)a=o[n].__mod__.__fns__[t],a&&r.push(a);return i[t]=r.slice(),r},make:function(t,e){if(!JS.isFn(e)||!JS.callsSuper(e))return e;var i=this;return function(){return i.chain(this,t,arguments)}},chain:JS.mask(function(t,e,i){var n,s=this.lookup(e),a=s.length-1,o=t.callSuper,r=JS.array(i);return t.callSuper=function(){for(var e=arguments.length;e--;)r[e]=arguments[e];a-=1;var i=s[a].apply(t,r);return a+=1,i},n=s.pop().apply(t,r),o?t.callSuper=o:delete t.callSuper,n}),resolve:function(t){var e,i,n,s,a=this.__mod__,t=t||a,o=t.__res__;if(t===a)for(a.uncache(!1),e=a.__dep__.length;e--;)a.__dep__[e].resolve();if(o){for(e=0,i=a.__inc__.length;i>e;e++)a.__inc__[e].resolve(t);for(n in a.__fns__)s=t.make(n,a.__fns__[n]),o[n]!==s&&(o[n]=s)}},uncache:function(t){var e=this.__mod__,i=e.__dep__.length;if(e.__anc__=null,e.__mct__={},t!==!1)for(;i--;)e.__dep__[i].uncache()}}),JS.Class=JS.makeFunction(),JS.extend(JS.Class.prototype=JS.makeBridge(JS.Module),{initialize:function(t,e,i){"string"==typeof t?this.__nom__=this.displayName=t:(this.__nom__=this.displayName="",i=e,e=t);var n=JS.extend(JS.makeFunction(),this);n.klass=n.constructor=this.klass,JS.isFn(e)||(i=e,e=Object),n.inherit(e),n.include(i,!1),n.resolve();do e.inherited&&e.inherited(n);while(e=e.superclass);return n},inherit:function(t){this.superclass=t,this.__eigen__&&t.__eigen__&&this.extend(t.__eigen__(),!0),this.subclasses=[],(t.subclasses||[]).push(this);var e=this.prototype=JS.makeBridge(t);e.klass=e.constructor=this,this.__mod__=new JS.Module(this.__nom__,{},{_1:this.prototype}),this.include(JS.Kernel,!1),t!==Object&&this.include(t.__mod__||new JS.Module(t.prototype,{_1:t.prototype}),!1)},include:function(t,e,i){if(t){var n=this.__mod__,i=i||{};return i._4=this,n.include(t,e,i)}},define:function(t,e,i,n){var s=this.__mod__;n=n||{},n._0=this,s.define(t,e,i,n)}}),JS.Module=new JS.Class("Module",JS.Module.prototype),JS.Class=new JS.Class("Class",JS.Module,JS.Class.prototype),JS.Module.klass=JS.Module.constructor=JS.Class.klass=JS.Class.constructor=JS.Class,JS.extend(JS.Module,{_3:[],__chainq__:[],methodAdded:function(t,e){this._3.push([t,e])},_0:function(t,e){for(var i=this._3,n=i.length;n--;)i[n][0].call(i[n][1]||null,t,e)}}),JS.Kernel=JS.extend(new JS.Module("Kernel",{__eigen__:function(){if(this.__meta__)return this.__meta__;var t=this.__nom__,e=this.klass.__nom__,i=t||(e?"#<"+e+">":""),n=this.__meta__=new JS.Module(i?i+".":"",{},{_1:this});return n.include(this.klass.__mod__,!1),n},equals:function(t){return this===t},extend:function(t,e){return this.__eigen__().include(t,e,{_2:this})},hash:function(){return this.__hashcode__=this.__hashcode__||JS.Kernel.getHashCode()},isA:function(t){return this.__eigen__().includes(t)},method:function(t){var e=this,i=e.__mcache__=e.__mcache__||{};return(i[t]||{}).fn===e[t]?i[t].bd:(i[t]={fn:e[t],bd:JS.bind(e[t],e)}).bd},methods:function(){return this.__eigen__().instanceMethods(!0)},tap:function(t,e){return t.call(e||null,this),this}}),{__hashIndex__:0,getHashCode:function(){return this.__hashIndex__+=1,(Math.floor((new Date).getTime()/1e3)+this.__hashIndex__).toString(16)}}),JS.Module.include(JS.Kernel),JS.extend(JS.Module,JS.Kernel.__fns__),JS.Class.include(JS.Kernel),JS.extend(JS.Class,JS.Kernel.__fns__),JS.Interface=new JS.Class({initialize:function(t){this.test=function(e,i){for(var n=t.length;n--;)if(!JS.isFn(e[t[n]]))return i?t[n]:!1;return!0}},extend:{ensure:function(){for(var t,e,i=JS.array(arguments),n=i.shift();t=i.shift();)if(e=t.test(n,!0),e!==!0)throw new Error("object does not implement "+e+"()")}}}),JS.Singleton=new JS.Class({initialize:function(t,e,i){return new new JS.Class(t,e,i)}});