/*
 * --------------------------------------------------------------------
 * jQuery inputToButton plugin
 * Author: Scott Jehl, scott@filamentgroup.com
 * Copyright (c) 2009 Filament Group 
 * licensed under MIT (filamentgroup.com/examples/mit-license.txt)
 * --------------------------------------------------------------------
*/
!function(t){t.fn.visualize=function(i,e){return t(this).each(function(){function a(){var i=l.colors,e=l.textColors,a={dataGroups:function(){var a=[];if("x"==l.parseDirection)s.find("tr:gt(0)").filter(l.rowFilter).each(function(s){a[s]={},a[s].points=[],a[s].color=i[s],e[s]&&(a[s].textColor=e[s]),t(this).find("td").filter(l.colFilter).each(function(){a[s].points.push(parseFloat(t(this).text()))})});else for(var n=s.find("tr:eq(1) td").filter(l.colFilter).size(),r=0;n>r;r++)a[r]={},a[r].points=[],a[r].color=i[r],e[r]&&(a[r].textColor=e[r]),s.find("tr:gt(0)").filter(l.rowFilter).each(function(){a[r].points.push(1*t(this).find("td").filter(l.colFilter).eq(r).text())});return a},allData:function(){var i=[];return t(this.dataGroups()).each(function(){i.push(this.points)}),i},dataSum:function(){var i=0,e=this.allData().join(",").split(",");return t(e).each(function(){i+=parseFloat(this)}),i},topValue:function(){var i=0,e=this.allData().join(",").split(",");return t(e).each(function(){parseFloat(this,10)>i&&(i=parseFloat(this))}),i},bottomValue:function(){var i=0,e=this.allData().join(",").split(",");return t(e).each(function(){i>this&&(i=parseFloat(this))}),i},memberTotals:function(){var i=[],e=this.dataGroups();return t(e).each(function(a){var l=0;t(e[a].points).each(function(t){l+=e[a].points[t]}),i.push(l)}),i},yTotals:function(){for(var i=[],e=this.dataGroups(),a=this.xLabels().length,l=0;a>l;l++){i[l]=[];var s=0;t(e).each(function(){i[l].push(this.points[l])}),i[l].join(",").split(","),t(i[l]).each(function(){s+=parseFloat(this)}),i[l]=s}return i},topYtotal:function(){var i=0,e=this.yTotals().join(",").split(",");return t(e).each(function(){parseFloat(this,10)>i&&(i=parseFloat(this))}),i},totalYRange:function(){return this.topValue()-this.bottomValue()},xLabels:function(){var i=[];return"x"==l.parseDirection?s.find("tr:eq(0) th").filter(l.colFilter).each(function(){i.push(t(this).html())}):s.find("tr:gt(0) th").filter(l.rowFilter).each(function(){i.push(t(this).html())}),i},yLabels:function(){var t=[];t.push(v);for(var i=Math.round(l.height/l.yLabelInterval),e=Math.ceil(b/i)||1;t[t.length-1]<f-e;)t.push(t[t.length-1]+e);return t.push(f),t}};return a}var l=t.extend({type:"bar",width:t(this).width(),height:t(this).height(),appendTitle:!0,title:null,appendKey:!0,rowFilter:"*",colFilter:"*",colors:["#be1e2d","#666699","#92d5ea","#ee8310","#8d10ee","#5a3b16","#26a4ed","#f45a90","#e9e744"],textColors:[],parseDirection:"x",pieMargin:20,pieLabelsAsPercent:!0,pieLabelPos:"inside",lineWeight:4,barGroupMargin:10,barMargin:1,yLabelInterval:30},i);l.width=parseFloat(l.width),l.height=parseFloat(l.height);var s=t(this),n={pie:function(){p.addClass("visualize-pie"),"outside"==l.pieLabelPos&&p.addClass("visualize-pie-outside");var i=Math.round(o.width()/2),e=Math.round(o.height()/2),a=e-l.pieMargin,s=0,n=t('<ul class="visualize-labels"></ul>').insertAfter(o);t.each(g,function(r){var o=0>=this||isNaN(this)?0:this/d;x.beginPath(),x.moveTo(i,e),x.arc(i,e,a,2*s*Math.PI-.5*Math.PI,2*(s+o)*Math.PI-.5*Math.PI,!1),x.lineTo(i,e),x.closePath(),x.fillStyle=u[r].color,x.fill();var h=s+o/2,p="inside"==l.pieLabelPos?a/1.5:a+a/5,c=Math.round(i+Math.sin(2*h*Math.PI)*p),f=Math.round(e-Math.cos(2*h*Math.PI)*p),v=c>i?"right":"left",g=f>e?"bottom":"top",b=parseFloat((100*o).toFixed(2));if(b){var m=l.pieLabelsAsPercent?b+"%":this,z=t('<span class="visualize-label">'+m+"</span>").css(v,0).css(g,0);z&&t('<li class="visualize-label-pos"></li>').appendTo(n).css({left:c,top:f}).append(z),z.css("font-size",a/8).css("margin-"+v,-z.width()/2).css("margin-"+g,-z.outerHeight()/2),u[r].textColor&&z.css("color",u[r].textColor)}s+=o})},line:function(i){i?p.addClass("visualize-area"):p.addClass("visualize-line");var e=o.width()/(z.length-1),a=t('<ul class="visualize-labels-x"></ul>').width(o.width()).height(o.height()).insertBefore(o);t.each(z,function(i){var l=t("<li><span>"+this+"</span></li>").prepend('<span class="line" />').css("left",e*i).appendTo(a),s=l.find("span:not(.line)"),n=s.width()/-2;0==i?n=0:i==z.length-1&&(n=-s.width()),s.css("margin-left",n).addClass("label")});var s=o.height()/b,n=o.height()/(w.length-1),r=t('<ul class="visualize-labels-y"></ul>').width(o.width()).height(o.height()).insertBefore(o);t.each(w,function(i){var e=t("<li><span>"+this+"</span></li>").prepend('<span class="line"  />').css("bottom",n*i).prependTo(r),a=e.find("span:not(.line)"),l=a.height()/-2;0==i?l=-a.height():i==w.length-1&&(l=0),a.css("margin-top",l).addClass("label")}),x.translate(0,m),t.each(u,function(){x.beginPath(),x.lineWidth=l.lineWeight,x.lineJoin="round";var a=this.points,n=0;x.moveTo(0,-(a[0]*s)),t.each(a,function(){x.lineTo(n,-(this*s)),n+=e}),x.strokeStyle=this.color,x.stroke(),i?(x.lineTo(n,0),x.lineTo(0,0),x.closePath(),x.fillStyle=this.color,x.globalAlpha=.3,x.fill(),x.globalAlpha=1):x.closePath()})},area:function(){n.line(!0)},bar:function(){p.addClass("visualize-bar");var i=o.width()/z.length,e=t('<ul class="visualize-labels-x"></ul>').width(o.width()).height(o.height()).insertBefore(o);t.each(z,function(a){var l=t('<li><span class="label">'+this+"</span></li>").prepend('<span class="line" />').css("left",i*a).width(i).appendTo(e),s=l.find("span.label");s.addClass("label")});var a=o.height()/b,s=o.height()/(w.length-1),n=t('<ul class="visualize-labels-y"></ul>').width(o.width()).height(o.height()).insertBefore(o);t.each(w,function(i){var e=t("<li><span>"+this+"</span></li>").prepend('<span class="line"  />').css("bottom",s*i).prependTo(n),a=e.find("span:not(.line)"),l=a.height()/-2;0==i?l=-a.height():i==w.length-1&&(l=0),a.css("margin-top",l).addClass("label")}),x.translate(0,m);for(var r=0;r<u.length;r++){x.beginPath();var h=(i-2*l.barGroupMargin)/u.length,c=h-2*l.barMargin;x.lineWidth=c;for(var d=u[r].points,f=0,v=0;v<d.length;v++){var g=f-l.barGroupMargin+r*h+h/2;g+=2*l.barGroupMargin,x.moveTo(g,0),x.lineTo(g,Math.round(-d[v]*a)),f+=i}x.strokeStyle=u[r].color,x.stroke(),x.closePath()}}},r=document.createElement("canvas");r.setAttribute("height",l.height),r.setAttribute("width",l.width);var o=t(r),h=l.title||s.find("caption").text(),p=(e||t('<div class="visualize" role="img" aria-label="Chart representing data from the table: '+h+'" />')).height(l.height).width(l.width).append(o),c=a(),u=c.dataGroups();c.allData();var d=c.dataSum(),f=c.topValue(),v=c.bottomValue(),g=c.memberTotals(),b=c.totalYRange(),m=l.height*(f/b),z=c.xLabels(),w=c.yLabels();if(l.appendTitle||l.appendKey)var M=t('<div class="visualize-info"></div>').appendTo(p);if(l.appendTitle&&t('<div class="visualize-title">'+h+"</div>").appendTo(M),l.appendKey){var y,T=t('<ul class="visualize-key"></ul>');y="x"==l.parseDirection?s.find("tr:gt(0) th").filter(l.rowFilter):s.find("tr:eq(0) th").filter(l.colFilter),y.each(function(i){t('<li><span class="visualize-key-color" style="background: '+u[i].color+'"></span><span class="visualize-key-label">'+t(this).text()+"</span></li>").appendTo(T)}),T.appendTo(M)}e||p.insertAfter(this),"undefined"!=typeof G_vmlCanvasManager&&(G_vmlCanvasManager.init(),G_vmlCanvasManager.initElement(o[0]));var x=o[0].getContext("2d");n[l.type](),t(".visualize-line li:first-child span.line, .visualize-line li:last-child span.line, .visualize-area li:first-child span.line, .visualize-area li:last-child span.line, .visualize-bar li:first-child span.line,.visualize-bar .visualize-labels-y li:last-child span.line").css("border","none"),e||p.bind("visualizeRefresh",function(){s.visualize(l,t(this).empty())})}).next()}}(jQuery);